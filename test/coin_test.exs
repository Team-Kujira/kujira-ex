defmodule KujiraCoinTest do
  alias Kujira.Coin
  use ExUnit.Case
  use Kujira.TestHelpers

  # doctest Kujira.Coin

  test "parses a valid string", %{channel: channel} do
    {:ok, coins} =
      Coin.parse_coins(
        channel,
        "21639factory/kujira12cjjeytrqcj25uv349thltcygnp9k0kukpct0e/uwink,4477ibc/FFA3D0E9C3CDE729559FB71A09E9E6CFA5A85AFABAC9F3CB5DD3942BFF935F9C,159621ukuji"
      )

    assert coins == [
             %Kujira.Coin{
               amount: 21639,
               token: %Kujira.Token{
                 denom: "factory/kujira12cjjeytrqcj25uv349thltcygnp9k0kukpct0e/uwink",
                 meta: %Kujira.Token.Meta{
                   coingecko_id: nil,
                   decimals: 6,
                   name: "WINK",
                   png:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/kujira/images/wink.png",
                   svg:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/kujira/images/wink.svg",
                   symbol: "WINK"
                 },
                 trace: nil
               }
             },
             %Kujira.Coin{
               amount: 4477,
               token: %Kujira.Token{
                 denom: "ibc/FFA3D0E9C3CDE729559FB71A09E9E6CFA5A85AFABAC9F3CB5DD3942BFF935F9C",
                 meta: %Kujira.Token.Meta{
                   coingecko_id: "switcheo",
                   decimals: 8,
                   name: "Carbon",
                   png:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/carbon/images/swth.png",
                   svg:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/carbon/images/swth.svg",
                   symbol: "SWTH"
                 },
                 trace: %Kujira.Token.Trace{base_denom: "swth", path: "transfer/channel-46"}
               }
             },
             %Kujira.Coin{
               amount: 159_621,
               token: %Kujira.Token{
                 denom: "ukuji",
                 meta: %Kujira.Token.Meta{
                   coingecko_id: "kujira",
                   decimals: 6,
                   name: "Kujira",
                   png:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/kujira/images/kuji.png",
                   svg:
                     "https://raw.githubusercontent.com/cosmos/chain-registry/master/kujira/images/kuji.svg",
                   symbol: "KUJI"
                 },
                 trace: nil
               }
             }
           ]
  end

  test "parses a large string", %{channel: channel} do
    {:ok, coins} =
      Coin.parse_coins(
        channel,
        "21639factory/kujira12cjjeytrqcj25uv349thltcygnp9k0kukpct0e/uwink,75637factory/kujira13x2l25mpkhwnwcwdzzd34cr8fyht9jlj7xu9g4uffe36g3fmln8qkvm3qn/unami,682factory/kujira143fwcudwy0exd6zd3xyvqt2kae68ud6n8jqchufu7wdg5sryd4lqtlvvep/urcpt,78204factory/kujira1643jxg8wasy5cfcn7xm8rd742yeazcksqlg4d7/umnta,2057262factory/kujira166ysf07ze5suazfzj0r05tv8amk2yn8zvsfuu7/uplnk,3factory/kujira168pnd5cyadhppfxvug4gchd52vuau5vkletxtfld7hdavwtgcu9sjem6z5/bKUJIaxlUSDC,2factory/kujira16rujrka8vk3c7l7raa37km8eqcxv9z583p3c6e288q879rwp23ksy6efce/bMNTA03,2factory/kujira16rujrka8vk3c7l7raa37km8eqcxv9z583p3c6e288q879rwp23ksy6efce/bMNTA05,4factory/kujira16rujrka8vk3c7l7raa37km8eqcxv9z583p3c6e288q879rwp23ksy6efce/bMNTA07,3factory/kujira16rujrka8vk3c7l7raa37km8eqcxv9z583p3c6e288q879rwp23ksy6efce/bampMNTA01,2factory/kujira16rujrka8vk3c7l7raa37km8eqcxv9z583p3c6e288q879rwp23ksy6efce/bqcMNTA02,531factory/kujira175yatpvkpgw07w0chhzuks3zrrae9z9g2y6r7u5pzqesyau4x9eqqyv0rr/ampMNTA,39factory/kujira19mmvst3l3y6c3mtyqhj7vxne4g69ayd9lq323w7k270p6fp0sy6qlv642l/urcpt,65711factory/kujira1aaudpfr9y23lt9d45hrmskphpdfaq9ajxd3ukh/unstk,3080factory/kujira1e224c8ry0nuun5expxm00hmssl8qnsjkd02ft94p3m2a33xked2qypgys3/urcpt,3factory/kujira1gqlvqhp8hqlvljcy2fpz39jslse39phye3drhe6ntdsmlyygkjwq9v6xmz/urcpt,5factory/kujira1h35rpadutnwjrsy8nn83fhfsu54xs3tpgsn04fd8l08lxdl22jeqt6jmhg/urcpt,268factory/kujira1jelmu9tdmr6hqg0d6qw4g6c9mwrexrzuryh50fwcavcpthp5m0uq20853h/urcpt,2factory/kujira1jwdc6rhj2jqc9kn4jc76denz8jtj00y3nqnutg/ubfit,9factory/kujira1kd2a2zct0yj4l7yz8r0hz55cmplz0n7jvjq8gj3sf42u0s6uurnsjf5meu/bKUJIATOM,215factory/kujira1l04ged98c7a7s9tllu62ld09ztylwf442qgm4thfgmadrvngeumsz4zrh2/urcpt,1factory/kujira1leewphkx87lq2yuz8pmxw4yqlenfm25ruahj75p6vhf2cfk7p82qwcr8mn/bSTARSaxlUSDC,406factory/kujira1m96ucsfpt2yy72w09z2rxjdj38y5qd8lqx5jtggnejmdua2ynpnsxyvjex/urcpt,264110312factory/kujira1md94f5metrd4fhecalrmhtac5t4upeg9gz2e24hmuszdtgfxy85qvkphnw/urcpt,344factory/kujira1n3fr5f56r2ce0s37wdvwrk98yhhq3unnxgcqus8nzsfxvllk0yxquurqty/ampKUJI,176889factory/kujira1qk00h5atutpsv900x202pxx42npjr9thg58dnqpa72f2p7m2luase444a7/uusk,240factory/kujira1qzu3up50auxhqyzfq56znuj8n38q2ra7daaf9ef7vg8gu66jh4fqd2wd2y/urcpt,60147factory/kujira1sc6a0347cc5q3k890jj0pf3ylx2s38rh4sza4t/ufuzn,38factory/kujira1sc6a0347cc5q3k890jj0pf3ylx2s38rh4sza4t/uyfuzn,5690factory/kujira1swkuyt08z74n5jl7zr6hx0ru5sa2yev5v896p6/local,6758factory/kujira1w4yaama77v53fp0f9343t9w2f932z526vj970n2jv5055a7gt92sxgwypf/urcpt,523353factory/kujira1xe0awk5planmtsmjel5xtx2hzhqdw5p8z66yqd/uaqla,6factory/kujira1xhxefc8v3tt0n75wpzfqcrukzyfneyttdppqst84zzdxnf223m2qm4g5at/urcpt,1factory/kujira1ya42knfcsvy6eztegsn3hz7zpjvhzn05ge85xa2dy2zrjeul9hnspp3c06/urcpt,929909533factory/kujira1yntegc5v3tvl0xfrde0rupnt9kfnx0sy9lytge9g2mryjknudk6qg4zyw9/urcpt,1factory/kujira1yqh4gfa75jh2q82e9ada98l9qz7xf0xvwa399cl52a4vrv3kxzvstrjuy0/bKUJIUSK,15265723142609ibc/004EBF085BBED1029326D56BE8A2E67C08CECE670A94AC1947DF413EF5130EB2,384ibc/0306D6B66EAA2EDBB7EAD23C0EC9DDFC69BB43E80B398035E90FBCFEF3FD1A87,29ibc/034FBAB83B9B8AB35217DD59452C92EBC845ECD2E44AB17D260D9A2E7200AC79,113003701011253184ibc/0447761C090DB521DAC0268E8CB4EBF567E519B937DE6FECD2472AA6A1EDE658,636995070694ibc/0A88A08F3E9573DB9D8CB74AA3746F6D23C41C3EE7B6CC5AA4695A1DD74FF86B,6070819962067ibc/0B41F8EB39912A15611BC834EB98962B59EE03C4CA8F781E709BB875BC18DC4B,764177002073644ibc/107ED1024220D5EE2A3E81BACD4A0B6709687F09043A53348E6D7E7647375593,819952ibc/119334C55720942481F458C9C462F5C0CD1F1E7EEAC4679D674AA67221916AEA,1ibc/1603E8643A49AD47F536F645A4BF0E4C1E06C76F0A98CBE8054B177F1EE7C39A,627ibc/173E561B8E97AB49FBA540663C1D02DC1B2D2871B5C8434935982CB15B0C7765,3768639044438ibc/1B38805B1C75352B28169284F96DF56BDEBD9E8FAC005BDCC8CF0378C82AA8E7,2ibc/21038E447A2D4A1183628C0EC366FE79C2E0B0BD91F9A85E6C906CD911FD676E,46429ibc/21F041CFE99994E0D027D0C5F72A9EB6224CBCAF5A6AD5DDB75F67A781D46C68,17ibc/239BFF83852F67DF5243DB89F339FF7FDBF858437F961CAB6DA5B5ADEFB2BC07,27ibc/2661BA7AD557526A9BE35C7576EEF8E82B14A01ECCE36AD139979FD683D37C9D,4471ibc/27394FB092D2ECCD56123C74F36E4C1F926001CEADA9CA97EA622B25F41E5EB2,92672ibc/295548A78785A1007F232DE286149A6FF512F180AF5657780FC89C009E2C348F,16ibc/301DAF9CB0A9E247CD478533EF0E21F48FF8118C4A51F77C8BC3EB70E5566DBC,54050984ibc/31ED168F5E93D988FCF223B1298113ACA818DB7BED8F7B73764C5C9FAC293609,41557ibc/359AF48D8512344FD8B6514CA79C26AC120B4F12FFE2D2A46528A58439272BD5,115ibc/3607EB5B5E64DD1C0E12E07F077FF470D5BC4706AFCBC98FE1BA960E5AE4CE07,32016156087ibc/3914BDEF46F429A26917E4D8D434620EC4817DC6B6E68FB327E190902F1E9242,4554ibc/3CF31CB1729FD2011718F66B20861D23A7FB6492C29FFADE2C1E58D10C3D225F,3033ibc/47BD209179859CDE4A2806763D7189B6E6FE13A17880FE2B42DE1E6C1E329E23,9102352ibc/4925CCFAD4FFBC63D7C52BB9AE2DE8CF7D0809124FBA1F44F4F2B7B4267D5E5A,700ibc/4EFD563C64F84F60AFB4BB7A8473AAA632CF5817FDF2CF51E68E4E3EDAE66430,120626ibc/4F393C3FCA4190C0A6756CE7F6D897D5D1BE57D6CCB80D0BC87393566A7B6602,168399ibc/53796B3762678CD80784A7DD426EB45B89C024BE3D45224CC83FDE3DED7DA0A1,16084ibc/590CE97A3681BC2058FED1F69B613040209DF3F17B7BD31DFFB8671C4D2CD99B,39926908559196ibc/5A3DCF59BC9EC5C0BB7AA0CA0279FC2BB126640CB8B8F704F7BC2DC42495041B,7260ibc/640E1C3E28FD45F611971DF891AE3DC90C825DF759DF8FAA8F33F7F72B35AD56,3318ibc/675CC877238E9063F5C63D8AC9435AE2833B499200F541C6F0F2D4F07CD65261,834ibc/68C6671BC8A27E137FD2E254F1C09A6147567D30B3490BB261F861EEC8843080,29319149254446ibc/6A4CEDCEA40B587A4BCF7FDFB1D5A13D13F8A807A22A4E759EA702640CE086B0,354ibc/7023F9629A70F8112764D959D04F52EA3115A0AED3CEE59694799FD8C91A97FA,4692653ibc/782817D588181841C9EB508E14B9A8A984E21590B83FEAC86BB44B0BA58C37F5,629ibc/8318B7E036E50C0CF799848F23ED84778AAA8749D9C0BCD4FF3F4AF73C53387F,18347848416978ibc/9012F7E79EACC34CE81A4404ECBEED5A5DFFD61CCEE23F2B8600BAC948C483E6,5350ibc/91DAE8E9D19A6A770D2A787E54E1D388F8E603D89093FC4939CE36125CB8284D,266945767129020ibc/950993C6DA64F5A60A48D65A18CAB2D8190DE2DC1B861E70E8B03C61F7D5FBDC,101618855828647ibc/96179F5B44CCC15E03AB43D7118E714B4D5CE8F187F7D8A60F2A514299761EA9,4399ibc/963532A97C3EF15733C579611D0A93D6B6789051330727EC3DEB173643236BEA,456ibc/A2146858B5E3CFE759E32F47CA54591F8E27FAEDFF731D30B448E5AB25CA8EC5,317ibc/A358D7F19237777AF6D8AD0E0F53268F8B18AE8A53ED318095C14D6D7F3B2DB5,262037357631844ibc/A64467480BBE4CCFC3CF7E25AD1446AA9BDBD4F5BCB9EF6038B83D6964C784E6,547469ibc/A6826D67800ED864F3BF51D56B0165DAF2491B00D93433564158D87BAA0C82BE,6222ibc/A7A5C44AA67317F1B3FFB27BAFC89C9CC04F61306F6F834F89A74B8F82D252A1,13484631127ibc/A8558A4C2F51A63B43509424886D9232375DD0105A7C448BFCC2A6791753DE2C,1682ibc/AB5A3681C25F2FEE9F167C0345D6E7C52DBDFE6D6ADD38A76BF6A0028F42426D,83ibc/AF371F507606449381F82454241BF562E742312BE5744B08AF66D8840C12A5C6,175894ibc/B37E4D9FB5B30F3E1E20A4B2DE2A005E584C5C822C44527546556AE2470B4539,47336862888ibc/B4B3B08FE5FEA65CB25E467C9D95D180A6CDB0EBE730E7BB20CA1BF6C9A80D9B,508476050583ibc/B4DCACF7753C05040AF0A7BF2B583402C4B8C9B0A86FCECE32EF63CB7F0A46B3,407455157578ibc/B572E6F30E7C33D78A50D8B4E973A9C118C30F848DF31A95FAA5E4C7450A8BD0,449ibc/B618D0F4CBB4AF5E21B4FF163CCBFBC278C037D1DA3E1D848EDF32716A216BE4,517ibc/B64A07C006C0F5E260A8AD50BD53568F1FD4A0D75B7A9F8765C81BEAFDA62053,76ibc/BBC45F1B65B6D3C11C3C56A9428D38C3A8D03944473791C52DFB7CD3F8342CBC,6927209441821ibc/BF603AD88AA4C36FC8CA99F6D703CA1D7D437A1EA97023A73A8BA4437A05ABDF,713ibc/BFDEE4E7F0E8371F195C2A6CFB70E54C18361E475FC26BE3A38B36E55FCEFDD6,179ibc/C01154C2547F4CB10A985EA78E7CD4BA891C1504360703A37E1D7043F06B5E1F,47634313667ibc/C19813F6D22F91CC64D2EEDF8702904DD61E0D022972EDFE0039F70C8A6EAD24,142ibc/C8D63703F5805CE6A2B20555139CF6ED9CDFA870389648EB08D688B94B0AE2C1,1544ibc/CF90BCBEDFF409F9187A0C3A69C1082D56908DC3F7FC342ED82455A504AD8AA9,63264ibc/D20559F0071F4BFDFF519D0C12B77AFE2A4481D44214BD92808B0C36B1E223C9,1158085ibc/D5F668AA43F9DE1F5E8A443EC5F9DD2D71AB3F3DC42CCD374F8751615A13B70B,3624ibc/DA59C009A0B3B95E0549E6BF7B075C8239285989FF457A8EDDBB56F10B2A6986,395616663899ibc/DADB399E742FCEE71853E98225D13E44E90292852CD0033DF5CABAB96F80B833,2674ibc/DBF6ABDB5F3D4267C039967515594453F4A31007FD838A566F563A01D2C2FB80,1ibc/E41F596AC5F1BF0298758CC40CBF1DB2DA0615F10BF28E4D9E82B9EEE7A0DBF2,1586ibc/E5CA126979E2FFB4C70C072F8094D07ECF27773B37623AD2BF7582AD0726F0F3,669172527617989ibc/E67ADA2204A941CD4743E70771BA08E24885E1ADD6FD140CE1F9E0FEBB68C6B2,18ibc/EB5ADB11D03C6FE1D02BC7F44ED543A8DCFD950A420C5DED1E2B23EE931A0248,252ibc/EFF323CC632EC4F747C61BCE238A758EFDB7699C3226565F7C20DA06509D59A5,16ibc/F2331645B9683116188EF36FC04A809C28BD36B54555E8705A37146D0182F045,349587651786820ibc/F2A6A3D4C02E003CC3EDB84CFD1C6F8F0E21EE6815575C5FE82FAC7D96106239,65694345285797ibc/F3AA7EF362EC5E791FE78A0F4CCC69FEE1F9A7485EB1A8CAB3F6601C00522F10,310ibc/F97BDCE220CCB52139C73066E36C45EC7EDCEEF1DAFF891A34F4FBA195A2E6E8,3561017871093ibc/FC59D6840A41252352263CEA2B832BB86D68D03CBA194263CB9F3C15946796FB,42807098489877ibc/FD021051CD0A21590CAC7907B22749B19CC8CCB6A22DE48C21FE7D9EF1EE80B7,139893ibc/FE98AAD68F02F03565E9FA39A5E627946699B2B07115889ED812D8BA639576A9,4477ibc/FFA3D0E9C3CDE729559FB71A09E9E6CFA5A85AFABAC9F3CB5DD3942BFF935F9C,159621ukuji"
      )

    assert Enum.count(coins) == 118
  end
end
